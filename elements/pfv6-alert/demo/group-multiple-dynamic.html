<div class="pf-v6-l-flex pf-m-gap-xs">
  <div>
    <button id="add-collection" type="button" class="pf-v6-c-button pf-m-secondary">
      Add alert collection
    </button>
  </div>
</div>

<pfv6-alert-group id="alert-group" has-animations is-toast is-live-region>
  <!-- Alerts will be dynamically inserted here -->
</pfv6-alert-group>

<script type="module">
  import '@pfv6/elements/pfv6-alert/pfv6-alert.js';

  let alerts = [];
  const alertGroup = document.getElementById('alert-group');
  const addBtn = document.getElementById('add-collection');

  function getUniqueId() {
    return String.fromCharCode(65 + Math.floor(Math.random() * 26)) + Date.now();
  }

  function createAlert(title, variant, key) {
    const alert = document.createElement('pfv6-alert');
    alert.variant = variant;
    alert.title = title;

    // Create close button
    const closeButton = document.createElement('pfv6-alert-action-close-button');
    closeButton.variantLabel = `${variant} alert`;
    closeButton.slot = 'action-close';
    closeButton.addEventListener('click', () => removeAlert(key));

    alert.appendChild(closeButton);
    return alert;
  }

  function removeAlert(key) {
    const index = alerts.findIndex(a => a.key === key);
    if (index !== -1) {
      const alertData = alerts[index];
      const alertElement = alertData.element;

      // Set outgoing animation state
      alertElement.animation = 'outgoing';

      // Remove after transition completes
      alertElement.addEventListener('transitionend', (event) => {
        if (event.propertyName === 'grid-template-rows') {
          alertElement.remove();
        }
      });

      alerts.splice(index, 1);
    }
  }

  function addAlertCollection() {
    const newAlerts = [
      { title: 'First alert notification.', variant: 'success', key: getUniqueId() },
      { title: 'Second alert notification.', variant: 'warning', key: getUniqueId() },
      { title: 'Third alert notification.', variant: 'danger', key: getUniqueId() }
    ];

    newAlerts.forEach(({ title, variant, key }) => {
      const alert = createAlert(title, variant, key);

      // Insert at the beginning
      alertGroup.insertBefore(alert, alertGroup.firstChild);
      alerts.unshift({ key, element: alert });
    });
  }

  addBtn.addEventListener('click', addAlertCollection);
</script>
